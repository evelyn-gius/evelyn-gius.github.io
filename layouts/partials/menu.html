<nav class="nav">
    <ul class="menu" id="menu">
        {{ if .Site.Params.activeInSection }}
            {{ .Scratch.Set "currentPage" (.Site.GetPage (printf `/%s` .Section)) }}
        {{ else }}
            {{ .Scratch.Set "currentPage" . }}
        {{ end }}
        {{ $currentPage := .Scratch.Get "currentPage" }}
        {{ $ctx := . }}

        <!-- Iteriere über die Hauptmenüeinträge -->
        {{ range .Site.Menus.main }}
            <!-- Überprüfe, ob der Menüeintrag "talks" ist -->
            {{ if eq .Identifier "talks" }}
                <!-- Füge einen Dropdown-Menüeintrag für "talks" hinzu -->
                <li class="menu-item{{ if or ($currentPage.IsMenuCurrent "main" .) ($currentPage.HasMenuCurrent "main" .) }} active{{ end }}">
                    <a href="{{ .URL }}"{{ if eq (string .Pre) "external" }} target="_blank" rel="external noopener"{{ end }}>
                        <span class="menu-link{{ if eq (string .Pre) "external" }} external{{ end }}">
                            {{- $iconName := (string .Post) -}}
                            {{- partial "utils/icon.html" (dict "$" $ "name" $iconName "class" .Identifier) -}}
                            {{- with .Name -}}
                                <span class="menu-item-name">{{ . }}</span>
                            {{- end -}}
                        </span>
                    </a>
                    <!-- Generiere das Dropdown-Menü für "talks" -->
                    <span class="drop-icon" for="{{ .Name }}">▾</span>
                    <ul class="sub-menu">
                        <!-- Lese den Inhalt aller Markdown-Dateien im "talks"-Verzeichnis -->
                        {{ $talksDir := "content/de/talks/" }}
                        {{ $talksFiles := readDir $talksDir }}
                        {{ range $talksFiles }}
                            <!-- Extrahiere die Überschriften aus jeder Markdown-Datei -->
                            {{ $content := .Content | readFile }}
                            {{ $headings := findRE $content `<div id="([^"]+)"[^>]*><h3>([^<]+)</h3>` }}
                            {{ range $headings }}
                                {{ $id := index . 1 }}
                                {{ $title := index . 2 }}
                                <li class="{{ if $currentPage.HasMenuCurrent "main" . }}active{{ end }}">
                                    <a href="#{{ $id }}">{{ $title }}</a>
                                </li>
                            {{ end }}
                        {{ end }}
                    </ul>
                </li>
            {{ else }}
                <!-- Füge normale Menüeinträge hinzu -->
                <li class="menu-item{{ if or ($currentPage.IsMenuCurrent "main" .) ($currentPage.HasMenuCurrent "main" .) }} active{{ end }}">
                    <a href="{{ .URL }}"{{ if eq (string .Pre) "external" }} target="_blank" rel="external noopener"{{ end }}>
                        <span class="menu-link{{ if eq (string .Pre) "external" }} external{{ end }}">
                            {{- $iconName := (string .Post) -}}
                            {{- partial "utils/icon.html" (dict "$" $ "name" $iconName "class" .Identifier) -}}
                            {{- with .Name -}}
                                <span class="menu-item-name">{{ . }}</span>
                            {{- end -}}
                        </span>
                    </a>
                </li>
            {{ end }}
        {{ end }}
    </ul>
</nav>



<style>
    .menu-item {
        position: relative;
    }
    
    .sub-menu {
        position: absolute;
        top: 100%;
        left: 0;
        display: none;
        z-index: 999;
        background-color: transparent;
        padding: 0.5rem 0;
        white-space: nowrap;
    }
  

    
    .sub-menu li {
        display: inline-block;
        margin-right: 0.5rem;
    }
    
    .sub-menu .sub-menu {
        top: 0;
        left: 100%;
    }
    
    .menu-item:hover .sub-menu {
        display: block;
    }
</style>


<script>
    const menuItems = document.querySelectorAll('.menu-item');

menuItems.forEach(item => {
  const dropIcon = item.querySelector('.drop-icon');
  const subMenu = item.querySelector('.sub-menu');

  if (dropIcon && subMenu) {
    item.addEventListener('mouseenter', () => {
      subMenu.style.display = 'block';
    });

    item.addEventListener('mouseleave', () => {
      subMenu.style.display = 'none';
    });

    const submenuLinks = subMenu.querySelectorAll('a');
    submenuLinks.forEach(link => {
      link.addEventListener('click', (event) => {
        event.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        const offset = targetElement.offsetTop - 100; // Hier wird der Offset von 20 Pixeln berücksichtigt
        window.scrollTo({ top: offset, behavior: 'smooth' });
      });
    });
  }
});

</script>
